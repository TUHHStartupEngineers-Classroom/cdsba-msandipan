{
  "hash": "bd5b26fe1c563b7032c721837c1de3e6",
  "result": {
    "markdown": "---\ntitle: \"Instrumental Variables\"\n---\n\n\n\n\n* Draw a DAG of how you understand the relationships\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-2_86bf7e67ab3115e8b4d1594a20df002e'}\n\n```{.r .cell-code}\ndf <- readRDS(\"~/GitHub/cdsba-msandipan/Causal_Data_Science_Data/rand_enc.rds\")\ndag_model <- dagify(time_spent~used_ftr,\n                    used_ftr~rand_enc,\n                    labels = c(\n                    \"used_ftr\" = \"used_ftr\",\n                    \"time_spent\" = \"time_spent\",\n                    \"rand_enc\"=\"rand_enc\"\n                    ),\n                    exposure = \"used_ftr\",\n                    outcome = \"time_spent\")\nggdag(dag_model, text = FALSE, use_labels = \"label\")\n```\n\n::: {.cell-output-display}\n![](09_iv_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n* Compute the naive, biased estimate.\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-3_18544fabaf64eae6b82167874bb776cb'}\n\n```{.r .cell-code}\nlm_biased<-lm(time_spent~used_ftr,data=df)\nsummary(lm_biased)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = time_spent ~ used_ftr, data = df)\n#> \n#> Residuals:\n#>      Min       1Q   Median       3Q      Max \n#> -20.4950  -3.5393   0.0158   3.5961  20.5051 \n#> \n#> Coefficients:\n#>             Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept) 18.86993    0.06955   271.3   <2e-16 ***\n#> used_ftr    10.82269    0.10888    99.4   <2e-16 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 5.351 on 9998 degrees of freedom\n#> Multiple R-squared:  0.497,\tAdjusted R-squared:  0.497 \n#> F-statistic:  9881 on 1 and 9998 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n\n* For the assumptions that can be (partly) tested, check whether they are satisfied by either computing correlations or drawing plots. Argue whether instrumental variable estimation is an adequate procedure.\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-4_11492145691710c4c0b27432eaa0fb23'}\n\n```{.r .cell-code}\ndf %>%\n   cor() %>% \n   round(2) %>% \n   Matrix::tril()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> 3 x 3 Matrix of class \"dtrMatrix\"\n#>            rand_enc used_ftr time_spent\n#> rand_enc       1.00        .          .\n#> used_ftr       0.20     1.00          .\n#> time_spent     0.13     0.71       1.00\n```\n:::\n:::\n\nThere is a positive correlation between the instrumental variable and the exposure which tells us that a random encouragement trial plays a role in the usage of the test feature.\n\n* Compute the IV estimate using 2SLS and compare it to the naive estimate. Would you consider the naive estimate biased, and if yes, does it have an upward or downward bias?\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-5_b54862ae9da3f763ac888772c9b064b7'}\n\n```{.r .cell-code}\nfirst_stage<-lm(used_ftr~rand_enc,data=df)\nsummary(first_stage)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = used_ftr ~ rand_enc, data = df)\n#> \n#> Residuals:\n#>     Min      1Q  Median      3Q     Max \n#> -0.5071 -0.3062 -0.3062  0.4929  0.6938 \n#> \n#> Coefficients:\n#>             Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept) 0.306164   0.006851   44.69   <2e-16 ***\n#> rand_enc    0.200940   0.009624   20.88   <2e-16 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 0.4811 on 9998 degrees of freedom\n#> Multiple R-squared:  0.04178,\tAdjusted R-squared:  0.04169 \n#> F-statistic:   436 on 1 and 9998 DF,  p-value: < 2.2e-16\n```\n:::\n\n```{.r .cell-code}\nsecond_stage <- lm(df$time_spent ~ first_stage$fitted.values)\nsummary(second_stage)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = df$time_spent ~ first_stage$fitted.values)\n#> \n#> Residuals:\n#>      Min       1Q   Median       3Q      Max \n#> -25.8757  -5.4714  -0.3263   5.3807  25.6541 \n#> \n#> Coefficients:\n#>                           Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept)                19.3124     0.3129   61.72   <2e-16 ***\n#> first_stage$fitted.values   9.7382     0.7447   13.08   <2e-16 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 7.482 on 9998 degrees of freedom\n#> Multiple R-squared:  0.01681,\tAdjusted R-squared:  0.01672 \n#> F-statistic:   171 on 1 and 9998 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n\nUpward Bias since it was leading to increase in relation. ",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}